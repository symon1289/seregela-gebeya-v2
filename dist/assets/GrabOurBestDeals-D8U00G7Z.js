import{u as N,r as l,f as k,h as w,a as M,j as s,C as L,c as R,P as $,d as q,e as E,g as F}from"./index-B1EEx9an.js";const A=()=>({headers:{Authorization:"Bearer "+window.localStorage.getItem("token")}}),I=({id:u,endpoint:n,initialItemsToLoad:o=15,searchName:m=""})=>{const{i18n:d}=N(),[f,y]=l.useState(0),[h,g]=l.useState(1e5),P=r=>{let a="";return n==="products"?(a=`products?page=${r}&paginate=${o}`,m&&(a+=`&name=${encodeURIComponent(m)}`)):u?a=`products/${u}`:a=`${n}?page=${r}&paginate=${o}`,a+=`&price[gte]=${f}&price[lte]=${h}`,a},{data:c,isLoading:v,error:x,hasNextPage:_,fetchNextPage:b,isFetchingNextPage:e}=k({queryKey:["products",n,u,o,m,f,h],queryFn:async({pageParam:r=1})=>{try{const a=P(r);if(!a)return{data:[],nextPage:null};const j=(await w.get(a,A())).data.data.map(t=>{var C;return{id:parseInt(t.id),name:t.name,name_am:t.name_am,price:t.price,discount:t.discount.toString(),image:((C=t.image_paths)==null?void 0:C[0])||"",created_at:t.created_at,originalPrice:(parseFloat(t.price)*(1+parseFloat(String(t.discount))/100)).toFixed(2),unit:t.measurement_type,left_in_stock:t.left_in_stock,description:t.description,description_am:t.description_am,supplier:t.supplier,brand:t.brand,measurement_type:t.measurement_type,category_id:t.category_id,category:t.category,subcategory:t.subcategory,subcategory_id:t.subcategory_id,stores:t.stores,total_quantity:t.total_quantity,rating:t.rating,is_non_stocked:t.is_non_stocked,is_active:t.is_active,image_paths:t.image_paths,updated_at:t.updated_at,max_quantity_per_order:t.max_quantity_per_order}});return{data:j,nextPage:j.length===o?r+1:null}}catch(a){return console.error("Error fetching products:",a),{data:[],nextPage:null}}},getNextPageParam:r=>r.nextPage,initialPageParam:1,enabled:!!(n&&(n==="products"||u||n==="popular-products"||n==="personalized-products"))}),i=l.useMemo(()=>(c==null?void 0:c.pages.flatMap(r=>r.data))??[],[c]),p=l.useMemo(()=>[...i].map(a=>({...a,name:(d.language==="am"?a.name_am:a.name)??"",description:(d.language==="am"?a.description_am:a.description)??""})),[i,d.language]),S=()=>{!e&&_&&b()};return{products:i,filteredProducts:p,isLoading:v,error:x,hasMore:!!_,page:(c==null?void 0:c.pages.length)??1,minPrice:f,maxPrice:h,loadMore:S,handlePriceChange:(r,a)=>{y(r),g(a)},isFetchingNextPage:e}},D=()=>{const{t:u}=N(),n=l.useRef(null),o=l.useRef(0),{user:m}=M(e=>e.auth),[d,f]=l.useState(!1),[y,h]=l.useState(!1),{filteredProducts:g,loadMore:P,hasMore:c,isLoading:v,isFetchingNextPage:x}=I({id:void 0,endpoint:"popular-products",initialItemsToLoad:7});l.useEffect(()=>{if(g.length>o.current&&o.current!==0){const e=o.current;o.current=g.length,requestAnimationFrame(()=>{const i=n.current;if(i){const p=i.children[e];p&&p.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}})}else o.current=g.length},[g]);const _=e=>{const i=n.current;i&&i.scrollBy({left:e==="left"?-200:200,behavior:"smooth"})},b=()=>{const e=n.current;e&&(f(e.scrollLeft>0),h(e.scrollLeft+e.clientWidth<e.scrollWidth))};return l.useEffect(()=>{b();const e=n.current;return e&&e.addEventListener("scroll",b),()=>{e&&e.removeEventListener("scroll",b)}},[g]),s.jsxs("section",{className:"mb-0",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h2",{className:"text-2xl sm:text-3xl leading-[19px] font-semibold",children:u("best_selling_items")}),!x&&c&&s.jsx("button",{"aria-label":"Load More",onClick:P,className:"bg-[#e9a83a] hover:bg-[#fed874] text-white text-sm sm:text-base transition-colors py-2 px-4 rounded-lg font-semibold",children:u("loadMore")}),x&&s.jsx("div",{className:"flex justify-center ",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#e9a83a]"})})]}),s.jsxs("div",{className:"relative",children:[d&&s.jsx("button",{"aria-label":"Left",onClick:()=>_("left"),className:"absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-200 rounded-full p-2 shadow-md z-10",children:s.jsx(L,{})}),y&&s.jsx("button",{"aria-label":"Right",onClick:()=>_("right"),className:"absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 rounded-full p-2 shadow-md z-10",children:s.jsx(R,{})}),s.jsx("div",{ref:n,className:"grid auto-cols-[10.5rem] grid-flow-col gap-3 overflow-x-auto",children:x||v?Array.from({length:14}).map((e,i)=>s.jsx($,{},i)):g.map(e=>s.jsx(q,{id:e.id,name:e.name,price:e.price,image:e.image||E,originalPrice:e.originalPrice,discount:e.discount?Number(e.discount):void 0,left_in_stock:F(m,e)??0},e.id))})]})]})};export{D as default};
