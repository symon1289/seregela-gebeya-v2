import{u as C,r as o,e as w,f as M,j as a,C as S,b as L,P as R,c as $,d as E}from"./index-BBCkqH49.js";const A=()=>({headers:{Authorization:"Bearer "+window.localStorage.getItem("token")}}),q=({id:u,endpoint:n,initialItemsToLoad:g=15,searchName:f=""})=>{const{i18n:h}=C(),[x,p]=o.useState(0),[l,y]=o.useState(1e5),P=r=>{let s="";return n==="products"?(s=`products?page=${r}&paginate=${g}`,f&&(s+=`&name=${encodeURIComponent(f)}`)):u?s=`products/${u}`:s=`${n}?page=${r}&paginate=${g}`,s+=`&price[gte]=${x}&price[lte]=${l}`,s},{data:c,isLoading:_,error:b,hasNextPage:d,fetchNextPage:e,isFetchingNextPage:i}=w({queryKey:["products",n,u,g,f,x,l],queryFn:async({pageParam:r=1})=>{try{const s=P(r);if(!s)return{data:[],nextPage:null};const v=(await M.get(s,A())).data.data.map(t=>{var j;return{id:parseInt(t.id),name:t.name,name_am:t.name_am,price:t.price,discount:t.discount.toString(),image:((j=t.image_paths)==null?void 0:j[0])||"",created_at:t.created_at,originalPrice:t.price,unit:t.measurement_type,left_in_stock:t.left_in_stock,description:t.description,description_am:t.description_am,supplier:t.supplier,brand:t.brand,measurement_type:t.measurement_type,category_id:t.category_id,category:t.category,subcategory:t.subcategory,subcategory_id:t.subcategory_id,stores:t.stores,total_quantity:t.total_quantity,rating:t.rating,is_non_stocked:t.is_non_stocked,is_active:t.is_active,image_paths:t.image_paths,updated_at:t.updated_at}});return{data:v,nextPage:v.length===g?r+1:null}}catch(s){return console.error("Error fetching products:",s),{data:[],nextPage:null}}},getNextPageParam:r=>r.nextPage,initialPageParam:1,enabled:!!(n&&(n==="products"||u||n==="popular-products"||n==="personalized-products"))}),m=o.useMemo(()=>(c==null?void 0:c.pages.flatMap(r=>r.data))??[],[c]),N=o.useMemo(()=>[...m].map(s=>({...s,name:(h.language==="am"?s.name_am:s.name)??"",description:(h.language==="am"?s.description_am:s.description)??""})),[m,h.language]),k=()=>{!i&&d&&e()};return{products:m,filteredProducts:N,isLoading:_,error:b,hasMore:!!d,page:(c==null?void 0:c.pages.length)??1,minPrice:x,maxPrice:l,loadMore:k,handlePriceChange:(r,s)=>{p(r),y(s)},isFetchingNextPage:i}},F=()=>{const{t:u}=C(),n=o.useRef(null),g=o.useRef(0),[f,h]=o.useState(!1),[x,p]=o.useState(!1),{filteredProducts:l,loadMore:y,hasMore:P,isLoading:c,isFetchingNextPage:_}=q({id:void 0,endpoint:"popular-products",initialItemsToLoad:7});o.useEffect(()=>{if(l.length>g.current){const e=g.current;g.current=l.length,requestAnimationFrame(()=>{const i=n.current;if(i){const m=i.children[e];m&&m.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"})}})}},[l]);const b=e=>{const i=n.current;i&&i.scrollBy({left:e==="left"?-200:200,behavior:"smooth"})},d=()=>{const e=n.current;e&&(h(e.scrollLeft>0),p(e.scrollLeft+e.clientWidth<e.scrollWidth))};return o.useEffect(()=>{d();const e=n.current;return e&&e.addEventListener("scroll",d),()=>{e&&e.removeEventListener("scroll",d)}},[l]),a.jsxs("section",{className:"mb-0",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-2xl sm:text-3xl leading-[19px] font-semibold",children:u("best_selling_items")}),!_&&P&&a.jsx("button",{"aria-label":"Load More",onClick:y,className:"bg-[#e9a83a] hover:bg-[#fed874] text-white text-sm sm:text-base transition-colors py-2 px-4 rounded-lg font-semibold",children:u("loadMore")}),_&&a.jsx("div",{className:"flex justify-center ",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#e9a83a]"})})]}),a.jsxs("div",{className:"relative",children:[f&&a.jsx("button",{"aria-label":"Left",onClick:()=>b("left"),className:"absolute left-0 top-1/2 transform -translate-y-1/2 bg-gray-200 rounded-full p-2 shadow-md z-10",children:a.jsx(S,{})}),x&&a.jsx("button",{"aria-label":"Right",onClick:()=>b("right"),className:"absolute right-0 top-1/2 transform -translate-y-1/2 bg-gray-200 rounded-full p-2 shadow-md z-10",children:a.jsx(L,{})}),a.jsx("div",{ref:n,className:"grid auto-cols-[10.5rem] grid-flow-col gap-3 overflow-x-auto",children:_||c?Array.from({length:14}).map((e,i)=>a.jsx(R,{},i)):l.map(e=>a.jsx($,{id:e.id,name:e.name,price:e.price,image:e.image||E,originalPrice:e.price,discount:e.discount?Number(e.discount):void 0,left_in_stock:e.left_in_stock},e.id))})]})]})};export{F as default};
